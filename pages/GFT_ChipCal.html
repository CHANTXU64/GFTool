<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>少女前线-芯片计算器 by 命运の乐章</title>
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="../vendor/metisMenu/metisMenu.min.css" rel="stylesheet">
    <link href="../dist/css/sb-admin-2.css" rel="stylesheet">
    <link href="../vendor/morrisjs/morris.css" rel="stylesheet">
    <link href="../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <style>
        .table_other{padding: 0px;text-align: center}
        .td_blueback{width:30px;height:30px;background:#606DA0;}
        .td_orangeback{width:30px;height:30px;background:#CE6B49;}
        .td_black{width:30px;height:30px;background:url("../img/chip/bg_black.png");}
        .td_b1{width:30px;height:30px;background:dodgerblue;}
        .td_b2{width:30px;height:30px;background:deepskyblue;}
        .td_b3{width:30px;height:30px;background:greenyellow;}
        .td_b4{width:30px;height:30px;background:limegreen;}
        .td_b5{width:30px;height:30px;background:orange;}
        .td_b6{width:30px;height:30px;background:#FF0066;}
        .td_b7{width:30px;height:30px;background:fuchsia;}
    </style>
    <script>
        var globaltime = [0, 0, 0, 0]; //global timer, for test and all result counting
        var switch_clear = false, switch_maxall = false;
        var topologySet = [], solutionSet = [], topologyNum = 0;
        var resultBuffer = [], resultRefer = []; //for buffer result for ranking
        var topologyLib_BGM_1 = [], topologyLibRefer_BGM_1 = [];
        var topologyLib_BGM_2 = [], topologyLibRefer_BGM_2 = [];
        var topologyLib_AGS = [], topologyLibRefer_AGS = [];
        var topologyLib_2B14 = [], topologyLibRefer_2B14 = [];
        var rules = ["InfinityFrost", "FatalChapters"];
        var color = 1;
        var block_dmg = 0, block_dbk = 0, block_acu = 0, block_fil = 0;
        var mul_property = 1;
        var chipNum = 0;
        var chipRepo_data = [];     //Chip data
        var chipRepo_shape_5 = [];   //For make shape only
        var chipRepo_shape_6 = [];   //For make shape only
        var chipRepo_chart = [];    //Repository information that display at repository-table
        var analyze_switch = 1, ranking_switch = 1; //show_percentage[1=validProperty,-1=validBlocknum] rank_result_by[1~6]
        var deleteSelectHTML = ['<option value=0 selected>选择编号</option>'];
        function creatChip(chipNum, chipColor, chipClass, chipType, chipLevel, blockAcu, blockFil, blockDmg, blockDbk, Den_Level) {
            var chipData = new Object;
            chipData.chipNum = chipNum; //chip number
            chipData.color = chipColor; //color
            chipData.classNum = chipClass; //56 or 551
            chipData.typeNum = chipType; //shape
            chipData.levelNum = chipLevel; //strengthen level
            chipData.bAcu = blockAcu; //acuracy block num
            chipData.bFil = blockFil; //filling block num
            chipData.bDmg = blockDmg; //damage block num
            chipData.bDbk = blockDbk; //defence-breaking block num
            chipData.weight = Den_Level; //density*level
            return chipData;
        }
        function creatRepo(chipNum, chipType, chipLevel, Acu, Fil, Dmg, Dbk) {
            var repoData = new Object;
            repoData.chipNum = chipNum;
            repoData.chipType = chipType;
            repoData.chipLevel = chipLevel;
            repoData.Acu = Acu;
            repoData.Fil = Fil;
            repoData.Dmg = Dmg;
            repoData.Dbk = Dbk;
            return repoData;
        }
        function loadScript(url) {
            var script = document.createElement('script');
            script.type = 'text/javascript';
            script.src = url;
            document.body.appendChild(script);
        }
        window.onload = function () {
            resetPage();
            loadScript('../js/topology.js');
        }
        function changeRepo(typeInfo) { // 刷新仓库显示，1=添加，2=删除某个，3=清空
            var ChipRepoChartId = document.getElementById('ChipRepoChart')
            var DeleteSelectId = document.getElementById('DeleteSelect')
            switch (typeInfo) {
                case 1:
                    chipNum++
                    var ChipClass = document.getElementById('ChipClass').value
                    var ChipType = document.getElementById('ChipType').value
                    var ChipLevel = document.getElementById('ChipLevel').value
                    var colorName
                    if (color === 1) colorName = 'b'
                    else colorName = 'o'
                    var Repo_p1 = chipNum + ''
                    var Repo_p2 = ''
                    var Repo_p3 = '+' + ChipLevel
                    var starNum = parseInt(((document.getElementById('ChipClass').value) + '').substr(0, 1))
                    for (var i = 0; i < starNum; i++) Repo_p2 += '★'
                    var Repo_Acu = Math.ceil(mul_property * Math.ceil(block_acu * 7.1))
                    var Repo_Fil = Math.ceil(mul_property * Math.ceil(block_fil * 5.7))
                    var Repo_Dmg = Math.ceil(mul_property * Math.ceil(block_dmg * 4.4))
                    var Repo_Dbk = Math.ceil(mul_property * Math.ceil(block_dbk * 12.7))
                    chipRepo_chart.push(creatRepo(Repo_p1, Repo_p2, Repo_p3, Repo_Acu, Repo_Fil, Repo_Dmg, Repo_Dbk))
                    var htmlString = '<img src="../img/chip/' + colorName + '_' + ChipClass + '-' + ChipType + '.png">'
                    var ChartAdd = ''
                    ChartAdd += '<tr>'
                    ChartAdd += '<td>' + chipRepo_chart[chipNum - 1].chipNum + '</td>'
                    ChartAdd += '<td>' + htmlString + ' ' + chipRepo_chart[chipNum - 1].chipType + '</td>'
                    ChartAdd += '<td>' + chipRepo_chart[chipNum - 1].chipLevel + '</td>'
                    ChartAdd += '<td>' + chipRepo_chart[chipNum - 1].Acu + '</td>'
                    ChartAdd += '<td>' + chipRepo_chart[chipNum - 1].Fil + '</td>'
                    ChartAdd += '<td>' + chipRepo_chart[chipNum - 1].Dmg + '</td>'
                    ChartAdd += '<td>' + chipRepo_chart[chipNum - 1].Dbk + '</td>'
                    ChartAdd += '</tr>'
                    ChipRepoChartId.innerHTML += ChartAdd
                    var Den_Level = 1; // 目前暂时没用
                    chipRepo_data.push(creatChip(chipNum, color, parseInt(ChipClass), parseInt(ChipType), parseInt(ChipLevel), block_acu, block_fil, block_dmg, block_dbk, Den_Level))
                    deleteSelectHTML.push(('<option value=' + chipNum) + ('>' + chipNum) + '</option>')
                    var selectText = ''
                    for (var i = 0; i < deleteSelectHTML.length; i++) selectText += deleteSelectHTML[i]
                    DeleteSelectId.innerHTML = selectText
                    document.getElementById('deleteChipButton').disabled = true
                    break
                case 2:
                    var deleteNum = parseInt(document.getElementById('DeleteSelect').value);
                    for (var i = 0; i < chipNum; i++) {
                        if (i + 1 > deleteNum) {
                            chipRepo_data[i].chipNum--;
                            chipRepo_chart[i].chipNum--;
                        }
                    }
                    chipRepo_data.splice(deleteNum - 1, 1);
                    chipRepo_chart.splice(deleteNum - 1, 1);
                    chipNum--;
                    ChipRepoChartId.innerHTML = ''; // CLEAR chart
                    deleteSelectHTML = ['<option value=0 selected>选择编号</option>'];
                    for (var i = 0; i < chipNum; i++) {
                        var ChartAdd = '';
                        var colorName;
                        if (chipRepo_data[i].color === 1) colorName = 'b';
                        else colorName = 'o';
                        var htmlString = '<img src="../img/chip/' + colorName + '_' + chipRepo_data[i].classNum + '-' + chipRepo_data[i].typeNum + '.png">';
                        ChartAdd += '<tr>';
                        ChartAdd += '<td>' + chipRepo_chart[i].chipNum + '</td>';
                        ChartAdd += '<td>' + htmlString + ' ' + chipRepo_chart[i].chipType + '</td>';
                        ChartAdd += '<td>' + chipRepo_chart[i].chipLevel + '</td>';
                        ChartAdd += '<td>' + chipRepo_chart[i].Acu + '</td>';
                        ChartAdd += '<td>' + chipRepo_chart[i].Fil + '</td>';
                        ChartAdd += '<td>' + chipRepo_chart[i].Dmg + '</td>';
                        ChartAdd += '<td>' + chipRepo_chart[i].Dbk + '</td>';
                        ChartAdd += '</tr>';
                        ChipRepoChartId.innerHTML += ChartAdd;
                        deleteSelectHTML.push(('<option value=' + chipRepo_chart[i].chipNum) + ('>' + chipRepo_chart[i].chipNum) + '</option>');
                    }
                    var selectText = '';
                    for (var i = 0; i < deleteSelectHTML.length; i++) selectText += deleteSelectHTML[i];
                    DeleteSelectId.innerHTML = selectText;
                    document.getElementById('deleteChipButton').disabled = true;
                    break;
                case 3:
                    if (switch_clear === false) {
                        switch_clear = true;
                        document.getElementById('alert_clear').innerHTML = ' * 再按一次确认清空芯片仓库';
                    } else {
                        switch_clear = false;
                        document.getElementById('alert_clear').innerHTML = '';
                        chipRepo_data = [];
                        chipRepo_chart = [];
                        chipNum = 0;
                        ChipRepoChartId.innerHTML = ''; // CLEAR chart
                        deleteSelectHTML = ['<option value=0 selected>选择编号</option>'];
                        DeleteSelectId.innerHTML = deleteSelectHTML[0];
                        break;
                    }
            }
            if (chipNum > 0) {
                document.getElementById('SaveButton').disabled = false
                document.getElementById('clearChipButton').disabled = false
                document.getElementById('maxAllButton').disabled = false
            } else {
                document.getElementById('SaveButton').disabled = true
                document.getElementById('deleteChipButton').disabled = true
                document.getElementById('clearChipButton').disabled = true
                document.getElementById('maxAllButton').disabled = true
            }
        }
        function maxAllChip() {
            var ChipRepoChartId = document.getElementById('ChipRepoChart');
            ChipRepoChartId.innerHTML = '';
            for (var c = 0; c < chipNum; c++) {
                if (chipRepo_data[c].levelNum < 20) {
                    chipRepo_data[c].levelNum = 20;
                    chipRepo_chart[c].chipLevel = '+20';
                    chipRepo_chart[c].Acu = Math.ceil(2.5 * Math.ceil(chipRepo_data[c].bAcu * 7.1));
                    chipRepo_chart[c].Fil = Math.ceil(2.5 * Math.ceil(chipRepo_data[c].bFil * 5.7));
                    chipRepo_chart[c].Dmg = Math.ceil(2.5 * Math.ceil(chipRepo_data[c].bDmg * 4.4));
                    chipRepo_chart[c].Dbk = Math.ceil(2.5 * Math.ceil(chipRepo_data[c].bDbk * 12.7));
                }
            }
            for (var c = 0; c < chipNum; c++) {
                var colorName;
                if (chipRepo_data[c].color === 1) colorName = 'b';
                else colorName = 'o';
                var htmlString = '<img src="../img/chip/' + colorName + '_' + chipRepo_data[c].classNum + '-' + chipRepo_data[c].typeNum + '.png">'
                var ChartAdd = ''
                ChartAdd += '<tr>'
                ChartAdd += '<td>' + chipRepo_chart[c].chipNum + '</td>'
                ChartAdd += '<td>' + htmlString + ' ' + chipRepo_chart[c].chipType + '</td>'
                ChartAdd += '<td>' + chipRepo_chart[c].chipLevel + '</td>'
                ChartAdd += '<td>' + chipRepo_chart[c].Acu + '</td>'
                ChartAdd += '<td>' + chipRepo_chart[c].Fil + '</td>'
                ChartAdd += '<td>' + chipRepo_chart[c].Dmg + '</td>'
                ChartAdd += '<td>' + chipRepo_chart[c].Dbk + '</td>'
                ChartAdd += '</tr>'
                ChipRepoChartId.innerHTML += ChartAdd;
            }
        }
        function getBlockNum(classNum) { return parseInt((classNum + "").substr(1, 1)); } //从classNum翻译blockNum
        function getSaveCode() { //获取存储码
            var SaveAlertId = document.getElementById('SaveAlert');
            var code = '[' + rules[0].substr(chipNum - 13 * parseInt(chipNum / 13), 1) + '!';
            for (var i = 0; i < chipRepo_data.length; i++) {
                code += (chipRepo_data[i].chipNum + ',');
                code += (chipRepo_data[i].color + ',');
                code += (chipRepo_data[i].classNum + ',');
                code += (chipRepo_data[i].typeNum + ',');
                code += (chipRepo_data[i].levelNum + ',');
                code += (chipRepo_data[i].bAcu + ',');
                code += (chipRepo_data[i].bFil + ',');
                code += (chipRepo_data[i].bDmg + ',');
                code += (chipRepo_data[i].bDbk + ',');
                code += (chipRepo_data[i].weight + '&');
            }
            code += '?' + rules[1].substr(chipNum - 13 * parseInt(chipNum / 13), 1) + ']';
            var SaveCodeId = document.getElementById('SaveCode');
            SaveCodeId.value = code;
            SaveCodeId.select();
            document.execCommand("Copy");
            SaveAlertId.innerHTML = '<span style="color:#FF0066">&nbsp&nbsp* 存储码已复制到剪贴板</span>';
        }
        function simpleCheck(LoadCode) { //简单检查存储码
            if (LoadCode[0] != '[' || LoadCode[LoadCode.length - 1] != ']') return false;
            var rule1 = LoadCode[1], rule2 = LoadCode[LoadCode.length - 2];
            var posi1 = [], posi2 = [];
            for (var i = 0; i < 13; i++) {
                if (rules[0][i] === rule1) posi1.push(i);
                if (rules[1][i] === rule2) posi2.push(i);
            }
            for (var i = 0; i < posi1.length; i++) {
                for (var j = 0; j < posi2.length; j++) {
                    if (posi1[i] === posi2[j]) return true;
                }
            }
            return false;
        }
        function setValue(elementNum, tempStr) { //从存储码里取值
            switch (elementNum) {
                case 0: chipNum = parseInt(tempStr) - 1; break;
                case 1: color = parseInt(tempStr); break;
                case 2: document.getElementById('ChipClass').value = parseInt(tempStr);
                    changeChipType(); break;
                case 3: document.getElementById('ChipType').value = parseInt(tempStr); break;
                case 4: document.getElementById('ChipLevel').value = parseInt(tempStr); break;
                case 5: block_acu = parseInt(tempStr); break;
                case 6: block_fil = parseInt(tempStr); break;
                case 7: block_dmg = parseInt(tempStr); break;
                case 8: block_dbk = parseInt(tempStr); break;
                case 9: break;
            }
        }
        function loadSaveCode() { //读档
            var LoadCode = document.getElementById('LoadCode').value;
            var LoadAlertId = document.getElementById('LoadAlert');
            if (simpleCheck(LoadCode)) {
                document.getElementById('ChipRepoChart').innerHTML = "";
                chipRepo_chart = []; chipRepo_data = []; deleteSelectHTML = ['<option value=0 selected>选择编号</option>'];
                resetPage();
                var scan = 3, elementNum = 0, tempStr = "";
                while (LoadCode[scan] != '?') { //'?' means end of code
                    if (LoadCode[scan] === ',') {
                        setValue(elementNum, tempStr);
                        elementNum++;
                        tempStr = "";
                    } else if (LoadCode[scan] === '&') {
                        setValue(elementNum, tempStr);
                        elementNum = 0;
                        tempStr = "";
                        changeLevel();
                        changeRepo(1);
                        resetPage();
                    } else {    //record
                        tempStr += LoadCode[scan];
                    }
                    scan++;
                }
                LoadAlertId.innerHTML = '';
                document.getElementById('SaveAlert').innerHTML = "";
                document.getElementById('panelS').className = "active";
                document.getElementById('panelSL').className = "";
                document.getElementById('ChipSetting').className = "tab-pane fade in active";
                document.getElementById('SaveLoad').className = "tab-pane fade";
            } else {
                LoadAlertId.innerHTML = '<span style="color:#FF0066">&nbsp&nbsp* 不正确的存储码</span>';
            }
        }
        function manageDeleteButton() {
            var DeleteSelectId = document.getElementById('DeleteSelect')
            if (parseInt(DeleteSelectId.value) > 0) document.getElementById('deleteChipButton').disabled = false
            else document.getElementById('deleteChipButton').disabled = true
        }
        function addBlock(typeInfo) { // 增加格数
            switch (typeInfo) {
                case 1: block_dmg++; break;
                case 2: block_dbk++; break;
                case 3: block_acu++; break;
                case 4: block_fil++; break;
            }
            refreshPreview()
            manageButton()
        }
        function subBlock(typeInfo) { // 减少格数
            var DmgId = document.getElementById('Dmg')
            var DbkId = document.getElementById('Dbk')
            var AcuId = document.getElementById('Acu')
            var FilId = document.getElementById('Fil')
            switch (typeInfo) {
                case 1: block_dmg--; break;
                case 2: block_dbk--; break;
                case 3: block_acu--; break;
                case 4: block_fil--; break;
            }
            refreshPreview();
            manageButton();
        }
        function changeColor(colorInfo) {
            color = colorInfo;
            changePrevireImg();
        }
        function changeChipType() { // star + blockNum + typeNum(or null)
            var seleId = document.getElementById('ChipType')
            var typeInfo = parseInt((document.getElementById('ChipClass')).value)
            switch (typeInfo) {
                case 56:
                    seleId.innerHTML = '<option value=1 selected>1</option><option value=2>2</option><option value=3>3</option><option value=41>4-a</option><option value=42>4-b</option><option value=5>5</option><option value=6>6</option><option value=7>7</option><option value=8>8</option><option value=9>9</option>'
                    changeTopSample(56);
                    break;
                case 551:
                    seleId.innerHTML = '<option value=11 selected>F-a</option><option value=12>F-b</option><option value=21>N-a</option><option value=22>N-b</option><option value=31>Y-a</option><option value=32>Y-b</option><option value=4>T</option><option value=5>W</option><option value=6>X</option>'
                    changeTopSample(551);
                    break;
            }
            changePrevireImg()
            resetBlock()
            manageButton();
        }
        function changePrevireImg() {
            var colorName
            if (color === 1) colorName = 'b'
            else colorName = 'o'
            var ChipClass = (document.getElementById('ChipClass')).value
            var ChipType = (document.getElementById('ChipType')).value
            var PreviewImgId = document.getElementById('PreviewImg')
            var pathName = '../img/chip/' + colorName + '_' + ChipClass + '-' + ChipType + '.png'
            PreviewImgId.src = pathName
            changePreviewType()
            manageButton();
        }
        function changePreviewType() {
            var PreviewTypeId = document.getElementById('PreviewType')
            var ClassId = document.getElementById('ChipClass')
            var ClassIdx = ClassId.selectedIndex
            var ClassName = ClassId[ClassIdx].text
            var TypeId = document.getElementById('ChipType')
            var TypeIdx = TypeId.selectedIndex
            var TypeName = TypeId[TypeIdx].text
            PreviewTypeId.innerHTML = ClassName + ' - 类型' + TypeName
        }
        function changeTopSample(typeInfo) {
            var imgId = document.getElementById('SampleImg');
            switch (typeInfo) {
                case 56: imgId.innerHTML = '<img src="../img/chipcal_56.png">'; break;
                case 551: imgId.innerHTML = '<img src="../img/chipcal_551.png">'; break;
            }
        }
        function changeLevel() {
            var level = parseInt((document.getElementById('ChipLevel')).value);
            var PreviewLevelId = document.getElementById('PreviewLevel');
            var LevelId = document.getElementById('ChipLevel');
            var LevelIdx = LevelId.selectedIndex;
            PreviewLevelId.innerHTML = LevelId[LevelIdx].text;
            if (level <= 10) mul_property = 1 + 0.08 * level;
            else mul_property = 1.8 + 0.07 * (level - 10);
            refreshPreview();
            manageButton();
        }
        function resetPage() {
            color = 1;
            mul_property = 1;
            document.getElementById('CSwitch1').checked = true;
            document.getElementById('ChipClass').value = 56; document.getElementById('ChipLevel').value = 0;
            changeChipType();
            changeLevel();
            resetBlock();
        }
        function resetBlock() {
            block_dmg = 0, block_dbk = 0, block_acu = 0, block_fil = 0;
            refreshPreview();
            manageButton();
        }
        function refreshPreview() {
            var DmgId = document.getElementById('Dmg');
            var DbkId = document.getElementById('Dbk');
            var AcuId = document.getElementById('Acu');
            var FilId = document.getElementById('Fil');
            var AdTx1 = document.getElementById('AdTx1');
            var AdTx2 = document.getElementById('AdTx2');
            var AdTx3 = document.getElementById('AdTx3');
            var AdTx4 = document.getElementById('AdTx4');
            DmgId.innerHTML = '<img src="../img/icon-dmg.png"> ' + Math.ceil(mul_property * Math.ceil(block_dmg * 4.4));
            DbkId.innerHTML = '<img src="../img/icon-dbk.png"> ' + Math.ceil(mul_property * Math.ceil(block_dbk * 12.7));
            AcuId.innerHTML = '<img src="../img/icon-acu.png"> ' + Math.ceil(mul_property * Math.ceil(block_acu * 7.1));
            FilId.innerHTML = '<img src="../img/icon-fil.png"> ' + Math.ceil(mul_property * Math.ceil(block_fil * 5.7));
            AdTx1.innerHTML = block_dmg;
            AdTx2.innerHTML = block_dbk;
            AdTx3.innerHTML = block_acu;
            AdTx4.innerHTML = block_fil;
        }
        function manageButton() {
            var AdBt1 = document.getElementById('AdBt1'); AdBt1.disabled = false;
            var AdBt2 = document.getElementById('AdBt2'); AdBt2.disabled = false;
            var AdBt3 = document.getElementById('AdBt3'); AdBt3.disabled = false;
            var AdBt4 = document.getElementById('AdBt4'); AdBt4.disabled = false;
            var SbBt1 = document.getElementById('SbBt1'); SbBt1.disabled = false;
            var SbBt2 = document.getElementById('SbBt2'); SbBt2.disabled = false;
            var SbBt3 = document.getElementById('SbBt3'); SbBt3.disabled = false;
            var SbBt4 = document.getElementById('SbBt4'); SbBt4.disabled = false;
            var AdBl = document.getElementById('AdBl'); AdBl.disabled = true;
            var SbBl = document.getElementById('SbBl'); SbBl.disabled = true;
            var AdSp = document.getElementById('AdSp'); AdSp.disabled = true;
            var SbSp = document.getElementById('SbSp'); SbSp.disabled = true;
            var AdLv = document.getElementById('AdLv'); AdLv.disabled = true;
            var SbLv = document.getElementById('SbLv'); SbLv.disabled = true;
            if (parseInt(document.getElementById('ChipClass').value) === 56) {
                AdBl.disabled = false;
                SbBl.disabled = true;
                if (parseInt(document.getElementById('ChipType').value) === 1) {
                    AdSp.disabled = false;
                    SbSp.disabled = true;
                } else if (parseInt(document.getElementById('ChipType').value) === 9) {
                    AdSp.disabled = true;
                    SbSp.disabled = false;
                } else {
                    AdSp.disabled = false;
                    SbSp.disabled = false;
                }
            } else {
                AdBl.disabled = true;
                SbBl.disabled = false;
                if (parseInt(document.getElementById('ChipType').value) === 11) {
                    AdSp.disabled = false;
                    SbSp.disabled = true;
                } else if (parseInt(document.getElementById('ChipType').value) === 6) {
                    AdSp.disabled = true;
                    SbSp.disabled = false;
                } else {
                    AdSp.disabled = false;
                    SbSp.disabled = false;
                }
            }
            if (parseInt(document.getElementById('ChipLevel').value) === 0) {
                AdLv.disabled = false;
                SbLv.disabled = true;
            } else if (parseInt(document.getElementById('ChipLevel').value) === 20) {
                AdLv.disabled = true;
                SbLv.disabled = false;
            } else {
                AdLv.disabled = false;
                SbLv.disabled = false;
            }
            var addChipButtonId = document.getElementById('addChipButton')
            addChipButtonId.disabled = true
            var blockNum = parseInt(((document.getElementById('ChipClass').value) + '').substr(1, 1))
            if (block_dmg + block_dbk + block_acu + block_fil >= blockNum) {
                AdBt1.disabled = true; AdBt2.disabled = true; AdBt3.disabled = true; AdBt4.disabled = true
            } else {
                if (blockNum >= 5) {
                    if (block_dmg === blockNum - 1) AdBt1.disabled = true
                    if (block_dbk === blockNum - 1) AdBt2.disabled = true
                    if (block_acu === blockNum - 1) AdBt3.disabled = true
                    if (block_fil === blockNum - 1) AdBt4.disabled = true
                } else {
                    if (block_dmg === blockNum) AdBt1.disabled = true
                    if (block_dbk === blockNum) AdBt2.disabled = true
                    if (block_acu === blockNum) AdBt3.disabled = true
                    if (block_fil === blockNum) AdBt4.disabled = true
                }
            }
            if (block_dmg === 0) SbBt1.disabled = true
            if (block_dbk === 0) SbBt2.disabled = true
            if (block_acu === 0) SbBt3.disabled = true
            if (block_fil === 0) SbBt4.disabled = true
            if (block_dmg + block_dbk + block_acu + block_fil === blockNum) addChipButtonId.disabled = false
        }
        function chartBack(typeInfo) {
            var line1 = document.getElementById('solutionLine1');
            var line2 = document.getElementById('solutionLine2');
            var line3 = document.getElementById('solutionLine3');
            var line4 = document.getElementById('solutionLine4');
            var line5 = document.getElementById('solutionLine5');
            var line6 = document.getElementById('solutionLine6');
            var line7 = document.getElementById('solutionLine7');
            var line8 = document.getElementById('solutionLine8');
            switch (typeInfo) {
                case 1:
                    Process_Text_Dmg.innerHTML = "0/190";
                    Process_Text_Dbk.innerHTML = "0/329";
                    Process_Text_Acu.innerHTML = "0/191";
                    Process_Text_Fil.innerHTML = "0/49";
                    line1.innerHTML = '<td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td>';
                    line2.innerHTML = '<td class="td_black"><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_black">';
                    line3.innerHTML = '<td class="td_black"><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_black">';
                    line4.innerHTML = '<td class="td_black"><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_black">';
                    line5.innerHTML = '<td class="td_black"><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_black">';
                    line6.innerHTML = '<td class="td_black"><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_black">';
                    line7.innerHTML = '<td class="td_black"><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_blueback"></td><td class="td_black">';
                    line8.innerHTML = '<td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td>';
                    break;
                case 2:
                    Process_Text_Dmg.innerHTML = "0/106";
                    Process_Text_Dbk.innerHTML = "0/130";
                    Process_Text_Acu.innerHTML = "0/120";
                    Process_Text_Fil.innerHTML = "0/233";
                    line1.innerHTML = '<td class="td_black"></td><td class="td_black"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td>';
                    line2.innerHTML = '<td class="td_black"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td>';
                    line3.innerHTML = '<td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_black"></td><td class="td_black"></td>';
                    line4.innerHTML = '<td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_black"></td>';
                    line5.innerHTML = '<td class="td_black"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td>';
                    line6.innerHTML = '<td class="td_black"></td><td class="td_black"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td>';
                    line7.innerHTML = '<td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_black"></td>';
                    line8.innerHTML = '<td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_black"></td><td class="td_black"></td>';
                    break;
                case 3:
                    Process_Text_Dmg.innerHTML = "0/227";
                    Process_Text_Dbk.innerHTML = "0/58";
                    Process_Text_Acu.innerHTML = "0/90";
                    Process_Text_Fil.innerHTML = "0/107";
                    line1.innerHTML = '<td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td>';
                    line2.innerHTML = '<td class="td_black"></td><td class="td_black"></td><td class="td_orangeback"></td><td class="td_black"></td><td class="td_black"></td><td class="td_orangeback"></td><td class="td_black"></td><td class="td_black"></td>';
                    line3.innerHTML = '<td class="td_black"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_black"></td>';
                    line4.innerHTML = '<td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td>';
                    line5.innerHTML = '<td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td>';
                    line6.innerHTML = '<td class="td_black"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_orangeback"></td><td class="td_black"></td>';
                    line7.innerHTML = '<td class="td_black"></td><td class="td_black"></td><td class="td_orangeback"></td><td class="td_black"></td><td class="td_black"></td><td class="td_orangeback"></td><td class="td_black"></td><td class="td_black"></td>';
                    line8.innerHTML = '<td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td><td class="td_black"></td>';
                    break;
            }
        }
        function countMS(td1, td2) { return ((60 * td2.getMinutes() + td2.getSeconds()) * 1000 + td2.getMilliseconds()) - ((60 * td1.getMinutes() + td1.getSeconds()) * 1000 + td1.getMilliseconds()); }
        function notIn(num, rank) {
            var ranklen = rank.length;
            for (var i = 0; i < ranklen; i++) if (rank[i] === num) return false;
            return true;
        }
        function getTopology() {
            globaltime[0] = 0;
            var td1 = new Date();
            topologySet = [], solutionSet = [];
            var HeavyfireStar = 5;
            var HeavyfireType = 1;
            if (document.getElementById('HFSwitch1').checked === true) HeavyfireType = 1;
            else if (document.getElementById('HFSwitch2').checked === true) HeavyfireType = 2;
            else HeavyfireType = 3;
            var validSet;
            var chipShape_5 = [[11, 0], [12, 0], [21, 0], [22, 0], [31, 0], [32, 0], [4, 0], [5, 0], [6, 0]];
            var chipShape_6 = [[1, 0], [2, 0], [3, 0], [41, 0], [42, 0], [5, 0], [6, 0], [7, 0], [8, 0], [9, 0]];
            var chipStat_5 = 0, chipStat_6 = 0;
            for (var i = 0; i < chipNum; i++) {
                if (getBlockNum(chipRepo_data[i].classNum) === 5) {
                    switch (chipRepo_data[i].typeNum) {
                        case 11: chipShape_5[0][1]++; break;
                        case 12: chipShape_5[1][1]++; break;
                        case 21: chipShape_5[2][1]++; break;
                        case 22: chipShape_5[3][1]++; break;
                        case 31: chipShape_5[4][1]++; break;
                        case 32: chipShape_5[5][1]++; break;
                        case 4: chipShape_5[6][1]++; break;
                        case 5: chipShape_5[7][1]++; break;
                        case 6: chipShape_5[8][1]++; break;
                    }
                    chipStat_5++;
                }
                else if (getBlockNum(chipRepo_data[i].classNum) === 6) {
                    switch (chipRepo_data[i].typeNum) {
                        case 1: chipShape_6[0][1]++; break;
                        case 2: chipShape_6[1][1]++; break;
                        case 3: chipShape_6[2][1]++; break;
                        case 41: chipShape_6[3][1]++; break;
                        case 42: chipShape_6[4][1]++; break;
                        case 5: chipShape_6[5][1]++; break;
                        case 6: chipShape_6[6][1]++; break;
                        case 7: chipShape_6[7][1]++; break;
                        case 8: chipShape_6[8][1]++; break;
                        case 9: chipShape_6[9][1]++; break;
                    }
                    chipStat_6++;
                }
            }
            validSet = searchValid(chipShape_6, chipShape_5);
            var allTopoNum = validSet.length;
            //get topology
            for (var num_topo = 0; num_topo < allTopoNum; num_topo++) {
                if (HeavyfireType === 1) {
                    if (validSet[num_topo] < topologyLibRefer_BGM_1.length) topologySet.push(topologyLib_BGM_1[validSet[num_topo]]);
                    else topologySet.push(topologyLib_BGM_2[validSet[num_topo] - topologyLibRefer_BGM_1.length]);
                } else if (HeavyfireType === 2) topologySet.push(topologyLib_AGS[validSet[num_topo]]);
                else if (HeavyfireType === 3) topologySet.push(topologyLib_2B14[validSet[num_topo]]);
            }
            if (topologySet.length > 0) { //get topology result
                document.getElementById('SortButton_AllPro').disabled = false;
                document.getElementById('SortButton_Block').disabled = false;
                document.getElementById('SortButton_Dmg').disabled = false;
                document.getElementById('SortButton_Dbk').disabled = false;
                document.getElementById('SortButton_Acu').disabled = false;
                document.getElementById('SortButton_Fil').disabled = false;
                var soluNum = topologySet.length;
                var panelO = document.getElementById('panelO'); panelO.className = '';
                var panelR = document.getElementById('panelR'); panelR.className = 'active';
                var Options = document.getElementById('Options'); Options.className = 'tab-pane fade';
                var Results = document.getElementById('Results'); Results.className = 'tab-pane fade in active';
                var TopologySelect = document.getElementById('TopologySelect');
                TopologySelect.disabled = false;
                var RTText = '<option value=0 selected>图解 1</option>';
                for (var i = 1; i < soluNum; i++) {
                    RTText += '<option value=' + i + '>图解 ' + (i + 1) + '</option>';
                }
                TopologySelect.innerHTML = RTText;
                var NoResultTextId = document.getElementById('NoResultText');
                NoResultTextId.innerHTML = '';
                topologyNum = 0;
                showSolution();
            } else {
                var NoResultTextId = document.getElementById('NoResultText');
                NoResultTextId.innerHTML = '<span style="color:#FF0066">&nbsp&nbsp* 没有可能的解</span>';
                var TopologySelect = document.getElementById('TopologySelect');
                TopologySelect.disabled = true;
                var RTText = '<option value=1 selected>图解编号</option>';
            }
            var td2 = new Date();
            globaltime[0] += countMS(td1, td2);
            document.getElementById('timeText').innerHTML = "总时间" + (globaltime[0] / 1000).toFixed(2) + "s";
        }
        function isPossible(chipShape_65, chipRefer, border) {
            for (var i = 0; i < border; i++) if (parseInt(chipRefer[i]) > chipShape_65[i][1]) return false;
            return true;
        }
        function searchValid(chipShape_6, chipShape_5) {
            var chipShape_65 = chipShape_6.concat(chipShape_5);
            var validSet = [];
            var HeavyfireType = 1, searchlen, searchlen_ex;
            if (document.getElementById('HFSwitch1').checked === true) {
                HeavyfireType = 1;
                searchlen = topologyLibRefer_BGM_1.length;
                searchlen_ex = topologyLibRefer_BGM_2.length;
            } else if (document.getElementById('HFSwitch2').checked === true) {
                HeavyfireType = 2;
                searchlen = topologyLibRefer_AGS.length;
            } else {
                HeavyfireType = 3;
                searchlen = topologyLibRefer_2B14.length;
            }
            if (HeavyfireType === 1) {
                for (var i = 0; i < searchlen; i++) {
                    if (isPossible(chipShape_65, topologyLibRefer_BGM_1[i], 10)) validSet.push(i);
                }
                for (var i = 0; i < searchlen_ex; i++) {
                    if (isPossible(chipShape_65, topologyLibRefer_BGM_2[i], 19)) validSet.push(i + searchlen);
                }
            } else if (HeavyfireType === 2) {
                for (var i = 0; i < searchlen; i++) {
                    if (isPossible(chipShape_65, topologyLibRefer_AGS[i], 19)) validSet.push(i);
                }
            } else if (HeavyfireType === 3) {
                for (var i = 0; i < searchlen; i++) {
                    if (isPossible(chipShape_65, topologyLibRefer_2B14[i], 19)) validSet.push(i);
                }
            }
            return validSet;
        }
        function showTopology(solution, HeavyfireType, HeavyfireStar) {
            var line1 = document.getElementById('solutionLine1');
            var line2 = document.getElementById('solutionLine2');
            var line3 = document.getElementById('solutionLine3');
            var line4 = document.getElementById('solutionLine4');
            var line5 = document.getElementById('solutionLine5');
            var line6 = document.getElementById('solutionLine6');
            var line7 = document.getElementById('solutionLine7');
            var line8 = document.getElementById('solutionLine8');
            var lineSet = [line1, line2, line3, line4, line5, line6, line7, line8];
            var htmlSet = [];
            for (var i = 0; i < 8; i++) htmlSet.push(['<td class="td_black"></td>', '<td class="td_black"></td>', '<td class="td_black"></td>', '<td class="td_black"></td>', '<td class="td_black"></td>', '<td class="td_black"></td>', '<td class="td_black"></td>', '<td class="td_black"></td>']);
            switch (HeavyfireType) {
                case 1:
                    var soluChipNum = solution.length;
                    for (var i = 0; i < soluChipNum; i++) {
                        putChip(1, 1, 6, i, solution[i], htmlSet);
                    }
                    break;
                case 2:
                    var soluChipNum = solution.length;
                    for (var i = 0; i < soluChipNum; i++) {
                        putChip(0, 0, 8, i, solution[i], htmlSet);
                    }
                    break;
                case 3:
                    var soluChipNum = solution.length;
                    for (var i = 0; i < soluChipNum; i++) {
                        putChip(0, 1, 8, i, solution[i], htmlSet);
                    }
                    break;
            }
            for (var i = 0; i < 8; i++) {
                var htmlText = '';
                for (var j = 0; j < 8; j++) {
                    htmlText += htmlSet[i][j];
                }
                lineSet[i].innerHTML = htmlText;
            }
        }
        function putChip(bios_x, bios_y, border_x, chipOrder, chipRank, htmlSet) {
            var chipNum = chipRank[0];
            var ranklen = chipRank.length;
            for (var i = 1; i < ranklen; i++) {
                if (chipRank[i] === 1) htmlSet[parseInt((i - 1) / border_x) + bios_y][i - border_x * parseInt((i - 1) / border_x) - 1 + bios_x] = '<td class="td_b' + (chipOrder - 7 * parseInt(chipOrder / 7) + 1) + '">' + '</td>';
            }
        }
        function changeTopology(actionId) {
            var HeavyfireStar = 5, HeavyfireType;
            if (document.getElementById('HFSwitch1').checked === true) HeavyfireType = 1;
            else if (document.getElementById('HFSwitch2').checked === true) HeavyfireType = 2;
            else HeavyfireType = 3;
            if (actionId === 0) topologyNum = parseInt(document.getElementById('TopologySelect').value);
            if (actionId === 1) topologyNum++;
            if (actionId === 2) topologyNum--;
            document.getElementById('TopologySelect').value = topologyNum;
            showSolution();
        }
        function changeAnalyze(actionId) {
            var HeavyfireStar = 5, HeavyfireType;
            if (document.getElementById('HFSwitch1').checked === true) HeavyfireType = 1;
            else if (document.getElementById('HFSwitch2').checked === true) HeavyfireType = 2;
            else HeavyfireType = 3;
            var SolutionSelect = document.getElementById('SolutionSelect');
            var SSV = parseInt(SolutionSelect.value);
            if (actionId === 1) SSV++;
            if (actionId === 2) SSV--;
            SolutionSelect.value = SSV;
            showAnalyze();
        }
        function showAnalyze() {
            var HeavyfireType;
            if (document.getElementById('HFSwitch1').checked === true) HeavyfireType = 1;
            else if (document.getElementById('HFSwitch2').checked === true) HeavyfireType = 2;
            else HeavyfireType = 3;
            var HeavyfireStar = 5;
            var SSNum = parseInt(document.getElementById('SolutionSelect').value);
            var c_num = solutionSet[SSNum].length;
            document.getElementById('AnalyzeSwitch').disabled = false;
            //show topology image
            showTopology(topologySet[topologyNum], HeavyfireType, HeavyfireStar);
            //show pick chips in chart
            var ChipComboChart = document.getElementById('ChipComboChart');
            ChipComboChart.innerHTML = '';
            for (var c = 0; c < c_num; c++) {
                var colorName;
                if (chipRepo_data[solutionSet[SSNum][c] - 1].color === 1) colorName = 'b';
                else colorName = 'o';
                var htmlString = '<img src="../img/chip/' + colorName + '_' + chipRepo_data[solutionSet[SSNum][c] - 1].classNum + '-' + chipRepo_data[solutionSet[SSNum][c] - 1].typeNum + '.png">';
                var ChartAdd = '';
                ChartAdd += '<tr>';
                ChartAdd += '<td>' + chipRepo_chart[solutionSet[SSNum][c] - 1].chipNum + '</td>';
                ChartAdd += '<td>' + htmlString + ' ' + chipRepo_chart[solutionSet[SSNum][c] - 1].chipType + '</td>';
                ChartAdd += '<td>' + chipRepo_chart[solutionSet[SSNum][c] - 1].chipLevel + '</td>';
                ChartAdd += '<td>' + chipRepo_chart[solutionSet[SSNum][c] - 1].Acu + '</td>';
                ChartAdd += '<td>' + chipRepo_chart[solutionSet[SSNum][c] - 1].Fil + '</td>';
                ChartAdd += '<td>' + chipRepo_chart[solutionSet[SSNum][c] - 1].Dmg + '</td>';
                ChartAdd += '<td>' + chipRepo_chart[solutionSet[SSNum][c] - 1].Dbk + '</td>';
                ChartAdd += '</tr>';
                ChipComboChart.innerHTML += ChartAdd;
            }
            //enable and disable topology & solution switch
            var AdTp = document.getElementById('AdTp');
            var SbTp = document.getElementById('SbTp');
            var AdCo = document.getElementById('AdCo');
            var SbCo = document.getElementById('SbCo');
            var topoV = parseInt(document.getElementById('TopologySelect').value);
            var combV = parseInt(document.getElementById('SolutionSelect').value);
            if (topoV === 0) SbTp.disabled = true;
            else SbTp.disabled = false;
            if (topoV === topologySet.length - 1) AdTp.disabled = true;
            else AdTp.disabled = false;
            if (combV === 0) SbCo.disabled = true;
            else SbCo.disabled = false;
            if (combV === solutionSet.length - 1) AdCo.disabled = true;
            else AdCo.disabled = false;
            //show percentage of property or blocknum
            var Process_Text_Dmg = document.getElementById('Process_Text_Dmg');
            var Process_Text_Dbk = document.getElementById('Process_Text_Dbk');
            var Process_Text_Acu = document.getElementById('Process_Text_Acu');
            var Process_Text_Fil = document.getElementById('Process_Text_Fil');
            var DmgAlert = document.getElementById('DmgAlert');
            var DbkAlert = document.getElementById('DbkAlert');
            var AcuAlert = document.getElementById('AcuAlert');
            var FilAlert = document.getElementById('FilAlert');
            var Process_Bar_Dmg = document.getElementById('Process_Bar_Dmg');
            var Process_Bar_Dbk = document.getElementById('Process_Bar_Dbk');
            var Process_Bar_Acu = document.getElementById('Process_Bar_Acu');
            var Process_Bar_Fil = document.getElementById('Process_Bar_Fil');
            if (analyze_switch === 1) {
                document.getElementById('AnalyzeSwitch').innerHTML = '显示有效格数';
                document.getElementById('AnalyzeSwitch').className = 'btn btn-outline btn-success';
                var dmg = 0, dbk = 0, acu = 0, fil = 0;
                var dmg_max = 0, dbk_max = 0, acu_max = 0, fil_max = 0;
                if (HeavyfireType === 1) { dmg_max = 190; dbk_max = 329; acu_max = 191; fil_max = 46; }
                else if (HeavyfireType === 2) { dmg_max = 106; dbk_max = 130; acu_max = 120; fil_max = 233; }
                else if (HeavyfireType === 3) { dmg_max = 227; dbk_max = 58; acu_max = 90; fil_max = 107; }
                for (var c = 0; c < c_num; c++) {
                    dmg += chipRepo_chart[solutionSet[SSNum][c] - 1].Dmg;
                    dbk += chipRepo_chart[solutionSet[SSNum][c] - 1].Dbk;
                    acu += chipRepo_chart[solutionSet[SSNum][c] - 1].Acu;
                    fil += chipRepo_chart[solutionSet[SSNum][c] - 1].Fil;
                }
                if (dmg > dmg_max) {
                    Process_Text_Dmg.innerHTML = '<span style="color:red">' + dmg + '</span>' + '/' + dmg_max;
                    DmgAlert.innerHTML = "* 杀伤溢出";
                    Process_Bar_Dmg.style = "width:100%";
                }
                else {
                    Process_Text_Dmg.innerHTML = dmg + '/' + dmg_max;
                    DmgAlert.innerHTML = "";
                    Process_Bar_Dmg.style = ("width:" + (dmg / dmg_max).toFixed(2) * 100 + "%");
                }
                if (dbk > dbk_max) {
                    Process_Text_Dbk.innerHTML = '<span style="color:red">' + dbk + '</span>' + '/' + dbk_max;
                    DbkAlert.innerHTML = "* 破防溢出";
                    Process_Bar_Dbk.style = "width:100%";
                }
                else {
                    Process_Text_Dbk.innerHTML = dbk + '/' + dbk_max;
                    DbkAlert.innerHTML = "";
                    Process_Bar_Dbk.style = ("width:" + (dbk / dbk_max).toFixed(2) * 100 + "%");
                }
                if (acu > acu_max) {
                    Process_Text_Acu.innerHTML = '<span style="color:red">' + acu + '</span>' + '/' + acu_max;
                    AcuAlert.innerHTML = "* 精度溢出";
                    Process_Bar_Acu.style = "width:100%";
                }
                else {
                    Process_Text_Acu.innerHTML = acu + '/' + acu_max;
                    AcuAlert.innerHTML = "";
                    Process_Bar_Acu.style = ("width:" + (acu / acu_max).toFixed(2) * 100 + "%");
                }
                if (fil > fil_max) {
                    Process_Text_Fil.innerHTML = '<span style="color:red">' + fil + '</span>' + '/' + fil_max;
                    FilAlert.innerHTML = "* 装填溢出";
                    Process_Bar_Fil.style = "width:100%";
                }
                else {
                    Process_Text_Fil.innerHTML = fil + '/' + fil_max;
                    FilAlert.innerHTML = "";
                    Process_Bar_Fil.style = ("width:" + (fil / fil_max).toFixed(2) * 100 + "%");
                }
            } else if (analyze_switch === -1) {
                document.getElementById('AnalyzeSwitch').innerHTML = '显示有效属性';
                document.getElementById('AnalyzeSwitch').className = 'btn btn-outline btn-warning';
                var dmg_blo = 0, dbk_blo = 0, acu_blo = 0, fil_blo = 0;
                var dmg_blomax = 0, dbk_blomax = 0, acu_blomax = 0, fil_blomax = 0;
                if (HeavyfireType === 1) { dmg_blomax = 18; dbk_blomax = 11; acu_blomax = 11; fil_blomax = 4; }
                else if (HeavyfireType === 2) { dmg_blomax = 10; dbk_blomax = 4; acu_blomax = 7; fil_blomax = 17; }
                else if (HeavyfireType === 3) { dmg_blomax = 21; dbk_blomax = 2; acu_blomax = 6; fil_blomax = 8; }
                for (var c = 0; c < c_num; c++) {
                    dmg_blo += chipRepo_data[solutionSet[SSNum][c] - 1].bDmg;
                    dbk_blo += chipRepo_data[solutionSet[SSNum][c] - 1].bDbk;
                    acu_blo += chipRepo_data[solutionSet[SSNum][c] - 1].bAcu;
                    fil_blo += chipRepo_data[solutionSet[SSNum][c] - 1].bFil;
                }
                if (dmg_blo > dmg_blomax) {
                    Process_Text_Dmg.innerHTML = '<span style="color:red">' + dmg_blo + '</span>' + '/' + dmg_blomax;
                    DmgAlert.innerHTML = "* 杀伤溢出";
                    Process_Bar_Dmg.style = "width:100%";
                } else {
                    Process_Text_Dmg.innerHTML = dmg_blo + '/' + dmg_blomax;
                    DmgAlert.innerHTML = "";
                    Process_Bar_Dmg.style = ("width:" + (dmg_blo / dmg_blomax).toFixed(2) * 100 + "%");
                }
                if (dbk_blo > dbk_blomax) {
                    Process_Text_Dbk.innerHTML = '<span style="color:red">' + dbk_blo + '</span>' + '/' + dbk_blomax;
                    DbkAlert.innerHTML = "* 破防溢出";
                    Process_Bar_Dbk.style = "width:100%";
                } else {
                    Process_Text_Dbk.innerHTML = dbk_blo + '/' + dbk_blomax;
                    DbkAlert.innerHTML = "";
                    Process_Bar_Dbk.style = ("width:" + (dbk_blo / dbk_blomax).toFixed(2) * 100 + "%");
                }
                if (acu_blo > acu_blomax) {
                    Process_Text_Acu.innerHTML = '<span style="color:red">' + acu_blo + '</span>' + '/' + acu_blomax;
                    AcuAlert.innerHTML = "* 精度溢出";
                    Process_Bar_Acu.style = "width:100%";
                } else {
                    Process_Text_Acu.innerHTML = acu_blo + '/' + acu_blomax;
                    AcuAlert.innerHTML = "";
                    Process_Bar_Acu.style = ("width:" + (acu_blo / acu_blomax).toFixed(2) * 100 + "%");
                }
                if (fil_blo > fil_blomax) {
                    Process_Text_Fil.innerHTML = '<span style="color:red">' + fil_blo + '</span>' + '/' + fil_blomax;
                    FilAlert.innerHTML = "* 装填溢出";
                    Process_Bar_Fil.style = "width:100%";
                } else {
                    Process_Text_Fil.innerHTML = fil_blo + '/' + fil_blomax;
                    FilAlert.innerHTML = "";
                    Process_Bar_Fil.style = ("width:" + (fil_blo / fil_blomax).toFixed(2) * 100 + "%");
                }
            }
        }
        function showSolution() {
            solutionSet = getSolution(topologySet[topologyNum]);
            SolutionSelect.disabled = false;
            sortSolution(ranking_switch);
            //new
            // var newResult = getResult(topologySet[topologyNum]);
            // if (newResult.length != 0) resultBuffer.push(newResult);
        }
        function getResult(topology) {
            var newResult = [];
            var resultlen = resultRefer.length;
            for (var i = 0; i < resultlen; i++) if (topologyNum === resultRefer[i]) return newResult; //check if buffered
            var solutionSet = getSolution(topology);
        }
        function getSolution(topology) {
            var tempChipRepo = []; //待选芯片数据的二维数组
            var topolen = topology.length;
            var type = [], typeNum = [], totalType = 0;
            var pickIdx = []; //二维数组，存放芯片选取组合的索引
            var chanegeIdx = 0;
            var solution = []; //二维数组，存放芯片选取组合的编号
            for (var i = 0; i < topolen; i++) { //记录芯片形状和对应数量
                var chipCode = parseInt(topology[i][0]);
                if (notIn(chipCode, type)) {
                    totalType++;
                    type.push(chipCode);
                    typeNum.push(1);
                } else {
                    for (var c = 0; c < totalType; c++) if (chipCode === type[c]) typeNum[c]++;
                }
            }
            for (var t = 0; t < totalType; t++) {
                tempChipRepo.push(searchChipSet(type[t])); //把对应芯片全备份
                pickIdx.push([]);
                for (var n = 0; n < typeNum[t]; n++) pickIdx[t].push(n); //初始化选取
            }
            var solutionRank_init = [];
            for (var t = 0; t < totalType; t++) {
                for (var n = 0; n < typeNum[t]; n++) {
                    solutionRank_init.push(tempChipRepo[t][pickIdx[t][n]].chipNum);
                }
            }
            solution.push(solutionRank_init);
            changeIdx = totalType - 1; //从最后一类开始变
            while (changeIdx > -1) {
                var changeCom = changeCombination(pickIdx[changeIdx], tempChipRepo[changeIdx].length);
                if (changeCom.length > 0) { //有新的解
                    pickIdx[changeIdx] = changeCom;
                    var solutionRank = [];
                    for (var t = 0; t < totalType; t++) {
                        for (var n = 0; n < typeNum[t]; n++) {
                            solutionRank.push(tempChipRepo[t][pickIdx[t][n]].chipNum);
                        }
                    }
                    solution.push(solutionRank);
                    changeIdx = totalType - 1;
                } else {
                    pickIdx[changeIdx] = [];
                    for (var n = 0; n < typeNum[changeIdx]; n++) pickIdx[changeIdx].push(n); //初始化选取
                    changeIdx--;
                }
            }
            return solution;
        }
        function changeCombination(rank, pickLimit) {
            var currentCombination = rank;
            var cuComlen = currentCombination.length;
            var isCompact = true;
            for (var i = cuComlen - 1; i > 0; i--) {
                if (currentCombination[i] - currentCombination[i - 1] != 1) {
                    isCompact = false;
                    break;
                }
            }
            if (isCompact && (currentCombination[cuComlen - 1] === pickLimit - 1)) return []; //紧凑且触底
            else {
                var changeIdx = cuComlen - 1;
                while (true) {
                    if (currentCombination[changeIdx] < pickLimit - 1) {
                        currentCombination[changeIdx]++;
                        return currentCombination;
                    } else {
                        for (var i = changeIdx; i > 0; i--) {
                            if (currentCombination[i] - currentCombination[i - 1] != 1) {
                                changeIdx = i - 1;
                                currentCombination[changeIdx]++;
                                break;
                            }
                        }
                        while (changeIdx < cuComlen - 1) {
                            changeIdx++;
                            currentCombination[changeIdx] = currentCombination[changeIdx - 1] + 1;
                        }
                        return currentCombination;
                    }
                }
            }
        }
        function searchChipSet(chipCode) {
            var chipString = chipCode + "";
            var tempChipSet = [];
            var class_num, type_num;
            if (chipString.substr(0, 3) === '551') class_num = 551;
            else class_num = 56;
            type_num = parseInt(chipString.substr(3));
            for (var i = 0; i < chipNum; i++) if (chipRepo_data[i].classNum === class_num && chipRepo_data[i].typeNum === type_num) tempChipSet.push(chipRepo_data[i]);
            return tempChipSet;
        }
        function changeBlock(actionInfo) {
            var ChipClass = document.getElementById('ChipClass');
            if (actionInfo === 1) ChipClass.value = 551;
            else ChipClass.value = 56;
            changeChipType();
            manageButton();
        }
        function changeShape(actionInfo) {
            var ChipType = document.getElementById('ChipType');
            var ChipIdx = ChipType.selectedIndex;
            if (actionInfo === 1) ChipType.value = ChipType[parseInt(ChipIdx) + 1].value;
            else ChipType.value = ChipType[parseInt(ChipIdx) - 1].value;
            changePrevireImg();
            manageButton();
        }
        function editLevel(actionInfo) {
            var ChipLevel = document.getElementById('ChipLevel');
            if (actionInfo === 1) ChipLevel.value = parseInt(ChipLevel.value) + 1;
            else if (actionInfo === 2) ChipLevel.value = parseInt(ChipLevel.value) - 1;
            else if (actionInfo === 3) ChipLevel.value = 20;
            changeLevel();
            manageButton();
        }
        function sortSolution(sortType) {
            ranking_switch = parseInt(sortType);
            if (sortType === 1) analyze_switch = 1;
            else if (sortType === 2) analyze_switch = -1;
            if (document.getElementById('HFSwitch1').checked === true) HeavyfireType = 1;
            else if (document.getElementById('HFSwitch2').checked === true) HeavyfireType = 2;
            else HeavyfireType = 3;
            var dmg_max = 0, dbk_max = 0, acu_max = 0, fil_max = 0;
            var dmgblo_max = 0, dbkblo_max = 0, acublo_max = 0, filblo_max = 0;
            if (HeavyfireType === 1) { dmg_max = 190; dbk_max = 329; acu_max = 191; fil_max = 46; dmgblo_max = 18; dbkblo_max = 11; acublo_max = 11; filblo_max = 4; }
            else if (HeavyfireType === 2) { dmg_max = 106; dbk_max = 130; acu_max = 120; fil_max = 233; dmgblo_max = 10; dbkblo_max = 4; acublo_max = 7; filblo_max = 17; }
            else if (HeavyfireType === 3) { dmg_max = 227; dbk_max = 58; acu_max = 90; fil_max = 107; dmgblo_max = 21; dbkblo_max = 2; acublo_max = 6; filblo_max = 8; }
            var SolutionSelect = document.getElementById('SolutionSelect');
            var SSText = '';
            var solulen = solutionSet.length;
            switch (ranking_switch) {
                case 1: //All property
                    document.getElementById('SortInfo').innerHTML = '按 <span style="color:red"><b>有效总属性</b></span> 排序';
                    for (var a = 0; a < solulen; a++) {
                        for (var b = a + 1; b < solulen; b++) {
                            var value_a = 0, value_b = 0;
                            var dmg_a = 0, dmg_b = 0, dbk_a = 0, dbk_b = 0, acu_a = 0, acu_b = 0, fil_a = 0, fil_b = 0;
                            var looplen = solutionSet[0].length;
                            for (var n = 0; n < looplen; n++) {
                                dmg_a += chipRepo_chart[solutionSet[a][n] - 1].Dmg; dmg_b += chipRepo_chart[solutionSet[b][n] - 1].Dmg;
                                dbk_a += chipRepo_chart[solutionSet[a][n] - 1].Dbk; dbk_b += chipRepo_chart[solutionSet[b][n] - 1].Dbk;
                                acu_a += chipRepo_chart[solutionSet[a][n] - 1].Acu; acu_b += chipRepo_chart[solutionSet[b][n] - 1].Acu;
                                fil_a += chipRepo_chart[solutionSet[a][n] - 1].Fil; fil_b += chipRepo_chart[solutionSet[b][n] - 1].Fil;
                            }
                            if (dmg_a > dmg_max) dmg_a = dmg_max; if (dmg_b > dmg_max) dmg_b = dmg_max;
                            if (dbk_a > dbk_max) dbk_a = dbk_max; if (dbk_b > dbk_max) dbk_b = dbk_max;
                            if (acu_a > acu_max) acu_a = acu_max; if (acu_b > acu_max) acu_b = acu_max;
                            if (fil_a > fil_max) fil_a = fil_max; if (fil_b > fil_max) fil_b = fil_max;
                            value_a = (dmg_a / dmg_max) + (dbk_a / dbk_max) + (acu_a / acu_max) + (fil_a / fil_max);
                            value_b = (dmg_b / dmg_max) + (dbk_b / dbk_max) + (acu_b / acu_max) + (fil_b / fil_max);
                            if (value_b > value_a) {
                                var temp = solutionSet[a];
                                solutionSet[a] = solutionSet[b];
                                solutionSet[b] = temp;
                            }
                        }
                    }
                    break;
                case 2: //All blockNum
                    document.getElementById('SortInfo').innerHTML = '按 <span style="color:red"><b>有效格数</b></span> 排序';
                    for (var a = 0; a < solulen; a++) {
                        for (var b = a + 1; b < solulen; b++) {
                            var value_a = 0, value_b = 0;
                            var dmg_a = 0, dmg_b = 0, dbk_a = 0, dbk_b = 0, acu_a = 0, acu_b = 0, fil_a = 0, fil_b = 0;
                            var looplen = solutionSet[0].length;
                            for (var n = 0; n < looplen; n++) {
                                dmg_a += chipRepo_data[solutionSet[a][n] - 1].bDmg; dmg_b += chipRepo_data[solutionSet[b][n] - 1].bDmg;
                                dbk_a += chipRepo_data[solutionSet[a][n] - 1].bDbk; dbk_b += chipRepo_data[solutionSet[b][n] - 1].bDbk;
                                acu_a += chipRepo_data[solutionSet[a][n] - 1].bAcu; acu_b += chipRepo_data[solutionSet[b][n] - 1].bAcu;
                                fil_a += chipRepo_data[solutionSet[a][n] - 1].bFil; fil_b += chipRepo_data[solutionSet[b][n] - 1].bFil;
                            }
                            if (dmg_a > dmgblo_max) dmg_a = dmgblo_max; if (dmg_b > dmgblo_max) dmg_b = dmgblo_max;
                            if (dbk_a > dbkblo_max) dbk_a = dbkblo_max; if (dbk_b > dbkblo_max) dbk_b = dbkblo_max;
                            if (acu_a > acublo_max) acu_a = acublo_max; if (acu_b > acublo_max) acu_b = acublo_max;
                            if (fil_a > filblo_max) fil_a = filblo_max; if (fil_b > filblo_max) fil_b = filblo_max;
                            value_a = dmg_a + dbk_a + acu_a + fil_a;
                            value_b = dmg_b + dbk_b + acu_b + fil_b;
                            if (value_b > value_a) {
                                var temp = solutionSet[a];
                                solutionSet[a] = solutionSet[b];
                                solutionSet[b] = temp;
                            }
                        }
                    }
                    break;
                case 3: //Dmg
                    document.getElementById('SortInfo').innerHTML = '按 <span style="color:red"><b>杀伤</b></span> 排序';
                    for (var a = 0; a < solulen; a++) {
                        for (var b = a + 1; b < solulen; b++) {
                            var value_a = 0, value_b = 0;
                            var dmg_a = 0, dmg_b = 0;
                            var looplen = solutionSet[0].length;
                            for (var n = 0; n < looplen; n++) {
                                dmg_a += chipRepo_chart[solutionSet[a][n] - 1].Dmg; dmg_b += chipRepo_chart[solutionSet[b][n] - 1].Dmg;
                            }
                            if (dmg_a > dmg_max) dmg_a = dmg_max; if (dmg_b > dmg_max) dmg_b = dmg_max;
                            value_a = dmg_a; value_b = dmg_b;
                            if (value_b > value_a) {
                                var temp = solutionSet[a];
                                solutionSet[a] = solutionSet[b];
                                solutionSet[b] = temp;
                            }
                        }
                    }
                    break;
                case 4: //Dbk
                    document.getElementById('SortInfo').innerHTML = '按 <span style="color:red"><b>破防</b></span> 排序';
                    for (var a = 0; a < solulen; a++) {
                        for (var b = a + 1; b < solulen; b++) {
                            var value_a = 0, value_b = 0;
                            var dbk_a = 0, dbk_b = 0;
                            var looplen = solutionSet[0].length;
                            for (var n = 0; n < looplen; n++) {
                                dbk_a += chipRepo_chart[solutionSet[a][n] - 1].Dbk; dbk_b += chipRepo_chart[solutionSet[b][n] - 1].Dbk;
                            }
                            if (dbk_a > dbk_max) dbk_a = dbk_max; if (dbk_b > dbk_max) dbk_b = dbk_max;
                            value_a = dbk_a; value_b = dbk_b;
                            if (value_b > value_a) {
                                var temp = solutionSet[a];
                                solutionSet[a] = solutionSet[b];
                                solutionSet[b] = temp;
                            }
                        }
                    }
                    break;
                case 5: //Acu
                    document.getElementById('SortInfo').innerHTML = '按 <span style="color:red"><b>精度</b></span> 排序';
                    for (var a = 0; a < solulen; a++) {
                        for (var b = a + 1; b < solulen; b++) {
                            var value_a = 0, value_b = 0;
                            var acu_a = 0, acu_b = 0;
                            var looplen = solutionSet[0].length;
                            for (var n = 0; n < looplen; n++) {
                                acu_a += chipRepo_chart[solutionSet[a][n] - 1].Acu; acu_b += chipRepo_chart[solutionSet[b][n] - 1].Acu;
                            }
                            if (acu_a > acu_max) acu_a = acu_max; if (acu_b > acu_max) acu_b = acu_max;
                            value_a = acu_a; value_b = acu_b;
                            if (value_b > value_a) {
                                var temp = solutionSet[a];
                                solutionSet[a] = solutionSet[b];
                                solutionSet[b] = temp;
                            }
                        }
                    }
                    break;
                case 6: //Fil
                    document.getElementById('SortInfo').innerHTML = '按 <span style="color:red"><b>装填</b></span> 排序';
                    for (var a = 0; a < solulen; a++) {
                        for (var b = a + 1; b < solulen; b++) {
                            var value_a = 0, value_b = 0;
                            var fil_a = 0, fil_b = 0;
                            var looplen = solutionSet[0].length;
                            for (var n = 0; n < looplen; n++) {
                                fil_a += chipRepo_chart[solutionSet[a][n] - 1].Fil; fil_b += chipRepo_chart[solutionSet[b][n] - 1].Fil;
                            }
                            if (fil_a > fil_max) fil_a = fil_max; if (fil_b > fil_max) fil_b = fil_max;
                            value_a = fil_a; value_b = fil_b;
                            if (value_b > value_a) {
                                var temp = solutionSet[a];
                                solutionSet[a] = solutionSet[b];
                                solutionSet[b] = temp;
                            }
                        }
                    }
                    break;
            }
            SolutionSelect.disabled = false;
            for (var i = 0; i < solulen; i++) {
                SSText += '<option value=' + i + '>编号 ';
                var c_num = solutionSet[i].length;
                for (var c = 0; c < c_num; c++) SSText += (solutionSet[i][c] + " ");
                SSText += '</option>';
            }
            SolutionSelect.innerHTML = SSText;
            showAnalyze();
        }
        function switchAnalyze() {
            analyze_switch *= -1;
            showAnalyze();
        }
    </script>
</head>

<body>
    <div id="wrapper">
        <!-- Navigation -->
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html"><span style="color:#FF0066">少女前线工具</span> by 命运の乐章 (GF tools)</a>
            </div>
            <!-- NaviBar (Left) -->
            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        <li class="sidebar-search">
                            <div class="input-group custom-search-form">
                                <input type="text" class="form-control" placeholder="Search...">
                                <span class="input-group-btn">
                                    <button class="btn btn-default" type="button">
                                        <i class="fa fa-search"></i>
                                    </button>
                                </span>
                            </div>
                            <!-- /input-group -->
                        </li>
                        <!-- [NAVI]Home -->
                        <li>
                            <a href="index.html"><i class="fa fa-home fa-fw"></i> 主页 Home</a>
                        </li>
                        <!-- [NAVI]Gaming stratefy -->
                        <li>
                            <a href="GFT_Database.html"><i class="fa fa-book fa-fw"></i> 资料库 Database</a>
                        </li>
                        <!-- [NAVI]LogiRank -->
                        <li>
                            <a href="GFT_LogiRank.html"><i class="fa fa-briefcase fa-fw"></i> 后勤排序器 Logistics ranking</a>
                        </li>
                        <!-- [NAVI]LevelCal -->
                        <li>
                            <a href="GFT_LevelCal.html"><i class="fa fa-upload fa-fw"></i> 练级计算器 Levelup calculator</a>
                        </li>
                        <!-- [NAVI]IOPSimulate -->
                        <li>
                            <a href="GFT_IOPSimulate.html"><i class="fa fa-gears fa-fw"></i> 建造模拟器 IOP simulator</a>
                        </li>
                        <!-- [NAVI]ChipCal -->
                        <li>
                            <a href="GFT_ChipCal.html"><i class="fa fa-delicious fa-fw"></i> 芯片计算器 Chip calculator</a>
                        </li>
                    </ul>
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>
        <!-- Main Pages -->
        <div id="page-wrapper">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="tooltip-demo">
                            <h1 class="page-header">芯片计算器 <button type="button" data-toggle="tooltip" data-placement="bottom" title="可将输入的芯片自动填满重装回路 目前仍在优化中" class="btn btn-outline btn-default">?</button></h1>
                        </div>
                    </div>
                    <div class="col-lg-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                芯片录入
                            </div>
                            <div class="panel-body">
                                <ul class="nav nav-tabs">
                                    <li class="active" id="panelS">
                                        <a href="#ChipSetting" data-toggle="tab">芯片设置</a>
                                    </li>
                                    <li id="panelSL">
                                        <a href="#SaveLoad" data-toggle="tab">保存/读取数据</a>
                                    </li>
                                </ul>
                                <!-- Tab panes -->
                                <div class="tab-content">
                                    <!--CHIPSETTING-->
                                    <div class="tab-pane fade in active" id="ChipSetting">
                                        <div class="col-lg-4">
                                            <!--chip class-->
                                            <h4>芯片属性</h4>
                                            <div>
                                                <p id="SampleImg"><img src="../img/chipcal_56.png"></p>
                                            </div>
                                            <table class="table table-bordered table-hover">
                                                <tbody>
                                                    <tr>
                                                        <td>颜色</td>
                                                        <td>
                                                            <label class="radio-inline"><input type="radio" name="ColorSwitch" id="CSwitch1" value="b" onchange="changeColor(1)" checked><span style="color:darkblue">蓝色</span></label>
                                                            <label class="radio-inline"><input type="radio" name="ColorSwitch" id="CSwitch2" value="o" onchange="changeColor(2)"><span style="color:darkorange">橙色</span></label>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>格数
                                                            <button type="button" class="btn btn-outline btn-success" onclick="changeBlock(2)" id="SbBl" disabled>&lt</button>
                                                            <button type="button" class="btn btn-outline btn-warning" onclick="changeBlock(1)" id="AdBl">&gt</button>
                                                        </td>
                                                        <td>
                                                            <select class="form-control input-sm" id="ChipClass" onchange="changeChipType()">
                                                                <option value=56 selected>★★★★★ 六格</option>
                                                                <option value=551>★★★★★ 五格1类</option>
                                                            </select>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>形状
                                                            <button type="button" class="btn btn-outline btn-success" onclick="changeShape(2)" id="SbSp" disabled>&lt</button>
                                                            <button type="button" class="btn btn-outline btn-warning" onclick="changeShape(1)" id="AdSp">&gt</button>
                                                        </td>
                                                        <td>
                                                            <select class="form-control input-sm" id="ChipType" onchange="changePrevireImg()">
                                                                <option value=1 selected>1</option>
                                                                <option value=2>2</option>
                                                                <option value=3>3</option>
                                                                <option value=41>4-a</option>
                                                                <option value=42>4-b</option>
                                                                <option value=5>5</option>
                                                                <option value=6>6</option>
                                                                <option value=7>7</option>
                                                                <option value=8>8</option>
                                                                <option value=9>9</option>
                                                            </select>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>强化
                                                            <button type="button" class="btn btn-outline btn-primary" onclick="editLevel(1)" id="AdLv">+</button>
                                                            <button type="button" class="btn btn-outline btn-danger" onclick="editLevel(2)" id="SbLv" disabled>-&nbsp</button>
                                                            <button type="button" class="btn btn-outline btn-success" onclick="editLevel(3)" id="MaxLv">max</button>
                                                        </td>
                                                        <td>
                                                            <select class="form-control input-sm" id="ChipLevel" onchange="changeLevel()">
                                                                <option value=0 selected>+0</option>
                                                                <option value=1>+1</option>
                                                                <option value=2>+2</option>
                                                                <option value=3>+3</option>
                                                                <option value=4>+4</option>
                                                                <option value=5>+5</option>
                                                                <option value=6>+6</option>
                                                                <option value=7>+7</option>
                                                                <option value=8>+8</option>
                                                                <option value=9>+9</option>
                                                                <option value=10>+10</option>
                                                                <option value=11>+11</option>
                                                                <option value=12>+12</option>
                                                                <option value=13>+13</option>
                                                                <option value=14>+14</option>
                                                                <option value=15>+15</option>
                                                                <option value=16>+16</option>
                                                                <option value=17>+17</option>
                                                                <option value=18>+18</option>
                                                                <option value=19>+19</option>
                                                                <option value=20>+20(max)</option>
                                                            </select>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <table class="table table-bordered table-hover">
                                                <tbody>
                                                    <tr>
                                                        <td><img src="../img/icon-acu.png">
                                                            <lable>精度<span style="color:dodgerblue" id="AdTx3">0</span>格</lable>
                                                            <button type="button" class="btn btn-outline btn-primary" onclick="addBlock(3)" id="AdBt3">&nbsp+&nbsp</button>
                                                            <button type="button" class="btn btn-outline btn-danger" onclick="subBlock(3)" id="SbBt3">&nbsp-&nbsp&nbsp</button>
                                                        </td>
                                                        <td><img src="../img/icon-fil.png">
                                                            <lable>装填<span style="color:dodgerblue" id="AdTx4">0</span>格</lable>
                                                            <button type="button" class="btn btn-outline btn-primary" onclick="addBlock(4)" id="AdBt4">&nbsp+&nbsp</button>
                                                            <button type="button" class="btn btn-outline btn-danger" onclick="subBlock(4)" id="SbBt4">&nbsp-&nbsp&nbsp</button>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td><img src="../img/icon-dmg.png">
                                                            <lable>杀伤<span style="color:dodgerblue" id="AdTx1">0</span>格</lable>
                                                            <button type="button" class="btn btn-outline btn-primary" onclick="addBlock(1)" id="AdBt1">&nbsp+&nbsp</button>
                                                            <button type="button" class="btn btn-outline btn-danger" onclick="subBlock(1)" id="SbBt1">&nbsp-&nbsp&nbsp</button>
                                                        </td>
                                                        <td><img src="../img/icon-dbk.png">
                                                            <lable>破防<span style="color:dodgerblue" id="AdTx2">0</span>格</lable>
                                                            <button type="button" class="btn btn-outline btn-primary" onclick="addBlock(2)" id="AdBt2">&nbsp+&nbsp</button>
                                                            <button type="button" class="btn btn-outline btn-danger" onclick="subBlock(2)" id="SbBt2">&nbsp-&nbsp&nbsp</button>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <div class="tooltip-demo">
                                                <h4>芯片预览 <button type="button" data-toggle="tooltip" data-placement="bottom" title="对应属性 = 向上取整[基础值x格数] 精度7.1 装填5.7 杀伤4.4 破防12.7" class="btn btn-outline btn-default">?</button></h4>
                                            </div>
                                            <table class="table table-bordered table-hover">
                                                <tbody>
                                                    <tr>
                                                        <td id="PreviewImgHTML"><img id="PreviewImg" src=""> <b id="PreviewLevel"></b></td>
                                                        <td id="PreviewType"></td>
                                                    </tr>
                                                    <tr>
                                                        <td value=0 id="Acu" style='width:200px'><img src="../img/icon-acu.png"> 0</td>
                                                        <td value=0 id="Fil" style='width:200px'><img src="../img/icon-fil.png"> 0</td>
                                                    </tr>
                                                    <tr>
                                                        <td value=0 id="Dmg" style='width:200px'><img src="../img/icon-dmg.png"> 0</td>
                                                        <td value=0 id="Dbk" style='width:200px'><img src="../img/icon-dbk.png"> 0</td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <p id="errorInfo"></p>
                                            <p>
                                                <button type="button" class="btn btn-info" onclick="changeRepo(1)" id="addChipButton">将芯片添加进仓库</button>
                                                <button type="button" class="btn btn-danger" onclick="resetPage()">重置芯片属性</button>
                                            </p>
                                        </div>
                                        <div class="col-lg-8">
                                            <h4>芯片仓库</h4>
                                            <div class="col-lg-3">
                                                <p>
                                                    <select class="form-control" id="DeleteSelect" onchange="manageDeleteButton()">
                                                        <option value=0 selected>选择编号</option>
                                                    </select>
                                                </p>
                                            </div>
                                            <div class="col-lg-9">
                                                <p>
                                                    <button type="button" class="btn btn-warning" onclick="changeRepo(2)" id="deleteChipButton" disabled>删除该编号芯片</button>
                                                    <button type="button" class="btn btn-danger" onclick="changeRepo(3)" id="clearChipButton" disabled>清空芯片仓库</button><span style="color:#FF0066"><b id="alert_clear"></b></span>
                                                </p>
                                            </div>
                                            <div class="col-lg-12">
                                                <p>
                                                    <button type="button" class="btn btn-success" onclick="maxAllChip()" id="maxAllButton" disabled>全部满强化</button>
                                                </p>
                                            </div>
                                            <div class="col-lg-12">
                                                <div class="table-responsive" style='height:500px; overflow-y:scroll'>
                                                    <table class="table table-striped table-bordered table-hover">
                                                        <thead>
                                                            <tr>
                                                                <th>编号</th>
                                                                <th>类型</th>
                                                                <th>强化</th>
                                                                <th><img src="../img/icon-acu.png"></th>
                                                                <th><img src="../img/icon-fil.png"></th>
                                                                <th><img src="../img/icon-dmg.png"></th>
                                                                <th><img src="../img/icon-dbk.png"></th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="ChipRepoChart">
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                    <!--SAVELOAD-->
                                    <div class="tab-pane fade" id="SaveLoad">
                                        <div class="col-lg-6">
                                            <h4>存档芯片仓库数据</h4>
                                            <div class="form-group input-group">
                                                <span class="input-group-addon">存储码</span>
                                                <input type="text" class="form-control" placeholder="存储码将在这里显示" id="SaveCode" readonly>
                                            </div>
                                            <p><button type="button" class="btn btn-info" onclick="getSaveCode()" id="SaveButton" disabled>复制存储码</button><b id="SaveAlert"></b></p>
                                        </div>
                                        <div class="col-lg-6">
                                            <h4>读取存档</h4>
                                            <div class="form-group">
                                                <textarea class="form-control" rows="3" placeholder="将存储码粘贴在此，仓库将复现之前的结果" id="LoadCode"></textarea>
                                            </div>
                                            <p><button type="button" class="btn btn-warning" onclick="loadSaveCode()" id="LoadButton">读取存储码</button><b id="LoadAlert"></b></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- /.row -->
                <div class="row">
                    <!--Setting-->
                    <div class="col-lg-12">
                        <div class="panel panel-default" style="background:url(../img/CC-Heavyfire.png) no-repeat right 20px top 50px;">
                            <div class="panel-heading">
                                拼接结果
                            </div>
                            <!-- /.panel-heading -->
                            <div class="panel-body">
                                <div class="col-lg-12">
                                    <h4>重装部队类型</h4>
                                    <div class="col-lg-12">
                                        <p>
                                            <label class="radio-inline"><input type="radio" name="HFSwitch" id="HFSwitch1" value=1 onclick="chartBack(1)" checked><span style="color:darkblue"><b>BGM-71</b></span></label>
                                            <label class="radio-inline"><input type="radio" name="HFSwitch" id="HFSwitch2" value=2 onclick="chartBack(2)"><span style="color:darkorange"><b>AGS-30</b></span></label>
                                            <label class="radio-inline"><input type="radio" name="HFSwitch" id="HFSwitch3" value=3 onclick="chartBack(3)"><span style="color:darkorange"><b>2B-14</b></span></label>
                                        </p>
                                    </div>
                                    <div class="col-lg-12">
                                        <p><button type="button" class="btn btn-primary" onclick="getTopology()">计算拼接方案</button><b id="NoResultText"></b></p>
                                    </div>
                                </div>
                                <!-- Nav tabs -->
                                <ul class="nav nav-tabs">
                                    <li class="active" id="panelR">
                                        <a href="#Results" data-toggle="tab">结果</a>
                                    </li>
                                    <li id="panelO">
                                        <a href="#Options" data-toggle="tab">高级选项</a>
                                    </li>
                                </ul>
                                <!-- Tab panes -->
                                <div class="tab-content">
                                    <div class="tab-pane fade in active" id="Results">
                                        <div class="col-lg-4">
                                            <h4>图解 (Algorithm v4.0)</h4>
                                            <h5 id="timeText"></h5>
                                            <div class="table-responsive">
                                                <table class="table_other table-bordered table-hover" style="width:240px; height:240px;overflow:hidden">
                                                    <tbody>
                                                        <tr id="solutionLine1">
                                                            <td class="td_black"></td>
                                                            <td class="td_black"></td>
                                                            <td class="td_black"></td>
                                                            <td class="td_black"></td>
                                                            <td class="td_black"></td>
                                                            <td class="td_black"></td>
                                                            <td class="td_black"></td>
                                                            <td class="td_black"></td>
                                                        </tr>
                                                        <tr id="solutionLine2">
                                                            <td class="td_black"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_black"></td>
                                                        </tr>
                                                        <tr id="solutionLine3">
                                                            <td class="td_black"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_black"></td>
                                                        </tr>
                                                        <tr id="solutionLine4">
                                                            <td class="td_black"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_black"></td>
                                                        </tr>
                                                        <tr id="solutionLine5">
                                                            <td class="td_black"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_black"></td>
                                                        </tr>
                                                        <tr id="solutionLine6">
                                                            <td class="td_black"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_black"></td>
                                                        </tr>
                                                        <tr id="solutionLine7">
                                                            <td class="td_black"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_blueback"></td>
                                                            <td class="td_black"></td>
                                                        </tr>
                                                        <tr id="solutionLine8">
                                                            <td class="td_black"></td>
                                                            <td class="td_black"></td>
                                                            <td class="td_black"></td>
                                                            <td class="td_black"></td>
                                                            <td class="td_black"></td>
                                                            <td class="td_black"></td>
                                                            <td class="td_black"></td>
                                                            <td class="td_black"></td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                            <p>
                                                <table class="table table-bordered" style='width:220px'>
                                                    <tbody>
                                                        <tr>
                                                            <td style='text-align: center'>
                                                                <button type="button" class="btn btn-outline btn-success" id="AnalyzeSwitch" onclick="switchAnalyze()" disabled>切换为格数</button>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td>
                                                                <div style="width:220px; background:url(../img/icon-dmg.png) no-repeat left top;">
                                                                    <p>
                                                                        <strong>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</strong><strong id="Process_Text_Dmg">0/190</strong>
                                                                        <b><span class="pull-right text-muted" style="color:orangered" id="DmgAlert"></span></b>
                                                                    </p>
                                                                    <div class="progress progress-striped active">
                                                                        <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%" id="Process_Bar_Dmg">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div style="width:220px; background:url(../img/icon-dbk.png) no-repeat left top;">
                                                                    <p>
                                                                        <strong>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</strong><strong id="Process_Text_Dbk">0/329</strong>
                                                                        <b><span class="pull-right text-muted" style="color:orangered" id="DbkAlert"></span></b>
                                                                    </p>
                                                                    <div class="progress progress-striped active">
                                                                        <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%" id="Process_Bar_Dbk">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div style="width:220px; background:url(../img/icon-acu.png) no-repeat left top;">
                                                                    <p>
                                                                        <strong>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</strong><strong id="Process_Text_Acu">0/191</strong>
                                                                        <b><span class="pull-right text-muted" style="color:orangered" id="AcuAlert"></span></b>
                                                                    </p>
                                                                    <div class="progress progress-striped active">
                                                                        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%" id="Process_Bar_Acu">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                <div style="width:220px; background:url(../img/icon-fil.png) no-repeat left top;">
                                                                    <p>
                                                                        <strong>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</strong><strong id="Process_Text_Fil">0/46</strong>
                                                                        <b><span class="pull-right text-muted" style="color:orangered" id="FilAlert"></span></b>
                                                                    </p>
                                                                    <div class="progress progress-striped active">
                                                                        <div class="progress-bar progress-bar-primary" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%" id="Process_Bar_Fil">
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </p>
                                        </div>
                                        <div class="col-lg-8">
                                            <div class="tooltip-demo">
                                                <h4>组合的排序基准 <button type="button" data-toggle="tooltip" data-placement="bottom" title="芯片并非全部满强请选择“有效格” 按所选条件从高到低排序组合" class="btn btn-outline btn-default">?</button></h4>
                                            </div>
                                            <p>
                                                <button type="button" class="btn btn-outline btn-danger" onclick="sortSolution(1)" id="SortButton_AllPro" disabled>有效总属性</button>
                                                <button type="button" class="btn btn-outline btn-warning" onclick="sortSolution(2)" id="SortButton_Block" disabled>有效格</button>
                                            </p>
                                            <p>
                                                <button type="button" class="btn btn-default" onclick="sortSolution(3)" id="SortButton_Dmg" disabled>杀伤</button>
                                                <button type="button" class="btn btn-default" onclick="sortSolution(4)" id="SortButton_Dbk" disabled>破防</button>
                                                <button type="button" class="btn btn-default" onclick="sortSolution(5)" id="SortButton_Acu" disabled>精度</button>
                                                <button type="button" class="btn btn-default" onclick="sortSolution(6)" id="SortButton_Fil" disabled>装填</button>
                                            </p>
                                            <h4>方案选择</h4>
                                            <h5 id="SortInfo"></h5>
                                            <table class="table table-bordered table-hover" style='width:400px'>
                                                <tbody>
                                                    <tr>
                                                        <td style='width:130px'>图解
                                                            <button type="button" class="btn btn-outline btn-success" onclick="changeTopology(2)" id="SbTp" disabled> &lt </button>
                                                            <button type="button" class="btn btn-outline btn-warning" onclick="changeTopology(1)" id="AdTp" disabled> &gt </button>
                                                        </td>
                                                        <td style='width:200px'>
                                                            <select class="form-control input-sm" id="TopologySelect" style="width: 240px" onchange="changeTopology(0)" disabled>
                                                                <option value=-1>图解编号</option>
                                                            </select>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td style='width:130px'>组合
                                                            <button type="button" class="btn btn-outline btn-success" onclick="changeAnalyze(2)" id="SbCo" disabled> &lt </button>
                                                            <button type="button" class="btn btn-outline btn-warning" onclick="changeAnalyze(1)" id="AdCo" disabled> &gt </button>
                                                        </td>
                                                        <td style='width:200px'>
                                                            <select class="form-control input-sm" id="SolutionSelect" style="width: 240px" onchange="showAnalyze()" disabled>
                                                                <option value=-1>芯片组合</option>
                                                            </select>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <div class="table-responsive">
                                                <table class="table table-striped table-bordered table-hover">
                                                    <thead>
                                                        <tr>
                                                            <th>编号</th>
                                                            <th>类型</th>
                                                            <th>强化</th>
                                                            <th><img src="../img/icon-acu.png"></th>
                                                            <th><img src="../img/icon-fil.png"></th>
                                                            <th><img src="../img/icon-dmg.png"></th>
                                                            <th><img src="../img/icon-dbk.png"></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="ChipComboChart">
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="Options">
                                        <h4>高级设置</h4>
                                        <div class="col-lg-12">
                                            <h5>* 未完成</h5>
                                            <table class="table table-bordered table-hover" style="width:400px">
                                                <tbody>
                                                    <tr>
                                                        <td>允许最大溢出格数</td>
                                                        <td>
                                                            <div class="form-group">
                                                                <input class="form-control" placeholder="输入整数" value='∞' id="MaxOverflowValue" disabled>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <!-- /#wrapper -->
        <!-- jQuery -->
        <script src="../vendor/jquery/jquery.min.js"></script>
        <!-- Bootstrap Core JavaScript -->
        <script src="../vendor/bootstrap/js/bootstrap.min.js"></script>
        <!-- Metis Menu Plugin JavaScript -->
        <script src="../vendor/metisMenu/metisMenu.min.js"></script>
        <!-- Custom Theme JavaScript -->
        <script src="../dist/js/sb-admin-2.js"></script>
        <!-- Page-Level Demo Scripts - Notifications - Use for reference -->
        <script>
            // tooltip demo
            $('.tooltip-demo').tooltip({
                selector: "[data-toggle=tooltip]",
                container: "body"
            })
            // popover demo
            $("[data-toggle=popover]")
                .popover()
        </script>
</body>

</html>